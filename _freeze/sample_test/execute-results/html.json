{
  "hash": "ae5c936e61b2a5c1423cfc17e29a177f",
  "result": {
    "markdown": "---\ntitle: \"sample\"\neditor: visual\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n### GETTING THE LIBRARIES\nif (!require(pacman)) #<1>\n  install.packages(pacman)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: pacman\n```\n:::\n\n```{.r .cell-code}\npacman::p_load(tidyverse,\n               gridExtra,\n               tidytuesdayR,\n               dplyr,\n               dlookr,        # Exploratory data analysis\n               DMwR2, \n               here,          # Standardizes paths to data\n               formattable,\n               ggpubr,\n               maps,\n               plotly,\n               countrycode,\n               gganimate,\n               imager,\n               magick)\npacman::p_load_gh(\"coolbutuseless/ggpattern\")\n\n### setting theme for ggplot2\nggplot2::theme_set(ggplot2::theme_minimal(base_size = 14, base_family = \"sans\"))\n\n\n# setting width of code output\noptions(width = 65)\n\n# setting figure parameters for knitr\nknitr::opts_chunk$set(\n  fig.width = 8,        # 8\" width\n  fig.asp = 0.618,      # the golden ratio\n  fig.retina = 1,       # dpi multiplier for displaying HTML output on retina\n  fig.align = \"center\", # center align figures\n  dpi = 150             # higher dpi, sharper image\n)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Getting the Data using the tidytuesdayR package \ndeforestation_data <- tidytuesdayR::tt_load(2021, week = 15)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Compiling #TidyTuesday Information for 2021-04-06 ----\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- There are 5 files available ---\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Starting Download ---\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tDownloading file 1 of 5: `forest.csv`\n\tDownloading file 2 of 5: `forest_area.csv`\n\tDownloading file 3 of 5: `brazil_loss.csv`\n\tDownloading file 4 of 5: `soybean_use.csv`\n\tDownloading file 5 of 5: `vegetable_oil.csv`\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Download complete ---\n```\n:::\n\n```{.r .cell-code}\n# Getting all the underlying data in the dataset\nforest        <- deforestation_data$forest\nforest_area   <- deforestation_data$forest_area\nbrazil_loss   <- deforestation_data$brazil_loss\nsoyabean_use  <- deforestation_data$soybean_use\nvegetable_oil <- deforestation_data$vegetable_oil\ndeforestation_by_source <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-04-06/deforestation_by_source.csv')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 10 Columns: 4\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Column specification ─────────────────────────────────────────\nDelimiter: \",\"\nchr (1): Entity\ndbl (2): Year, Forest loss (ha)\nlgl (1): Code\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# world data from maps\n# Create a world map based on country codes\nworld <- map_data(\"world\")\n\n# Extract unique countries from the world dataset and store them in a tibble\nunique_countries <- world |>\n  select(region) |> # Assuming \"region\" is the column containing country names in the world dataset\n  unique() |>\n  as_tibble()\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# filter dataset functionality\nprocess_forest <- function (dataset, unique_countries) {\n  filtered_data <- dataset |>\n    select(entity, year, net_forest_conversion) |>\n    bind_rows(\n      anti_join(unique_countries, dataset, by = c(\"region\" = \"entity\")) |>\n        mutate(year = dataset[1, \"year\"]$year, net_forest_conversion = NA)\n    ) |>\n    mutate(entity = case_when(\n      entity == \"United States\" ~ \"USA\",\n      entity == \"United Kingdom\" ~ \"UK\",\n      TRUE ~ entity\n    )) |>\n    mutate(\n      entity = coalesce(entity, region),\n      forest_converstion = case_when(\n        net_forest_conversion < -400000 ~ \"<-400k\",\n        net_forest_conversion < -200000 ~ \"-400k to -200k\",\n        net_forest_conversion < -100000 ~ \"-200k to -100k\",\n        net_forest_conversion < 0 ~ \"-100k to 0\",\n        net_forest_conversion < 100000 ~ \"0 to 100k\",\n        net_forest_conversion < 200000 ~ \"100k to 200k\",\n        net_forest_conversion < 400000 ~ \"200k to 400k\",\n        is.na(net_forest_conversion) ~ NA_character_,\n        TRUE ~ \">400k\"\n      )\n    ) |>\n    mutate(forest_converstion = as_factor(forest_converstion) |>\n             fct_relevel(\"<-400k\", \"-400k to -200k\", \"-200k to -100k\", \"-100k to 0\", \"0 to 100k\", \"100k to 200k\", \"200k to 400k\", \">400k\"))\n  \n  \n  return(filtered_data)\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Divide data into tibbles based on year\nforest_decades <- split(forest, f = forest$year)\n\nfiltered_forests <- lapply(forest_decades, function(forest_ds) {\n  process_forest(forest_ds, unique_countries)\n})\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `forest_converstion = fct_relevel(...)`.\nCaused by warning:\n! 1 unknown level in `f`: 200k to 400k\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# filter highlighted countries\nfilter_countries <- function (dataset, variable){\n  highlight_data <- subset(dataset, variable %in% c(\"Brazil\", \"Tanzania\", \"China\", \"India\", \"Russia\", \"USA\", \"Australia\"))\n  return(highlight_data)\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncolor_mapping <-\n  c(\n    \"<-400k\" = \"#d73027\",\n    \"-400k to -200k\" = \"#f46d43\",\n    \"-200k to -100k\" = \"#fdae61\",\n    \"-100k to 0\" = \"#fee08b\",\n    \"0 to 100k\" = \"#d9ef8b\",\n    \"100k to 200k\" = \"#a6d96a\",\n    \"200k to 400k\" = \"#66bd63\",\n    \">400k\" = \"#1a9850\"\n  )\n\nworld <- subset(world, region != \"Antarctica\")\n\nhighlight_world <- filter_countries(world, world$region)\n\nhighlight_filtered_data <- lapply(filtered_forests, function(forest_ds) {\n  filter_countries(forest_ds, forest_ds$entity)\n})\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Create the ggplot map plot\nplot_1990 <- ggplot(filtered_forests$`1990`, aes(map_id = entity)) +\n  geom_map(\n    aes(fill = forest_converstion),\n    map = world,\n    color = \"#B2BEB5\",\n    linewidth = 0.25,\n    linetype = \"blank\"\n  ) +\n  geom_map(data = highlight_filtered_data$`1990`, aes(map_id = entity, fill = forest_converstion), map = highlight_world, color = \"#71797E\", show.legend = F) +\n  expand_limits(x = world$long, y = world$lat) +\n  scale_fill_manual(values = color_mapping, na.value = \"#F2F3F4\") +\n  coord_fixed(ratio = 1) +\n  labs(title = \"Net Forest Conversion by Country in 1990\",\n       subtitle = \"Net change in forest area measures forest expansion minus deforestation\",\n       caption = \"Data source: Our World in Data\",\n       fill = \"Net Forest Conversion (hectares)\"\n       ) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    legend.background = element_blank(),\n    plot.title      = element_text(size = 20, face = \"bold\", hjust = 0.5),\n    plot.subtitle   = element_text(size = 16, color = \"azure4\", hjust = 0.5),\n    plot.caption    = element_text(size = 12, color = \"azure4\", hjust = 0.95)\n  ) +\n  guides(\n    fill = guide_legend(\n      nrow = 1,\n      direction = \"horizontal\",\n      title.position = \"top\",\n      title.hjust = 0.5,\n      label.position = \"bottom\",\n      label.hjust = 1,\n      label.vjust = 1,\n      label.theme = element_text(lineheight = 0.25, size = 9),\n      keywidth = 1,\n      keyheight = 0.5\n    ),\n    color = guide_legend(\"No data\", override.aes=list(fill=\"#F2F3F4\"))\n  )\n\nplot_1990\n```\n\n::: {.cell-output-display}\n![](sample_test_files/figure-html/unnamed-chunk-8-1.png){fig-align='center'}\n:::\n\n```{.r .cell-code}\nggsave(plot_1990, filename = \"q1/plot_1990.jpg\", height=8, width=15, unit=\"in\", dpi = 120)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Create the ggplot map plot\nplot_2000 <- ggplot(filtered_forests$`2000`, aes(map_id = entity)) +\n  geom_map(\n    aes(fill = forest_converstion),\n    map = world,\n    color = \"#B2BEB5\",\n    linewidth = 0.25,\n    linetype = \"blank\"\n  ) +\n  geom_map(data = highlight_filtered_data$`2000`, aes(map_id = entity, fill = forest_converstion), map = highlight_world, color = \"#71797E\", show.legend = F) +\n  expand_limits(x = world$long, y = world$lat) +\n  scale_fill_manual(values = color_mapping, na.value = \"#F2F3F4\") +\n  coord_fixed(ratio = 1) +\n  labs(title = \"Net Forest Conversion by Country in 2000\",\n       subtitle = \"Net change in forest area measures forest expansion minus deforestation\",\n       caption = \"Data source: Our World in Data\",\n       fill = \"Net Forest Conversion (hectares)\"\n       ) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    plot.title      = element_text(size = 20, face = \"bold\", hjust = 0.5),\n    plot.subtitle   = element_text(size = 16, color = \"azure4\", hjust = 0.5),\n    plot.caption    = element_text(size = 12, color = \"azure4\", hjust = 0.95)\n  ) +\n  guides(\n    fill = guide_legend(\n      nrow = 1,\n      direction = \"horizontal\",\n      title.position = \"top\",\n      title.hjust = 0.5,\n      label.position = \"bottom\",\n      label.hjust = 1,\n      label.vjust = 1,\n      label.theme = element_text(lineheight = 0.25, size = 9),\n      keywidth = 1,\n      keyheight = 0.5,\n    )\n  )\n\nplot_2000\n```\n\n::: {.cell-output-display}\n![](sample_test_files/figure-html/unnamed-chunk-9-1.png){fig-align='center'}\n:::\n\n```{.r .cell-code}\nggsave(plot_2000, filename = \"q1/plot_2000.jpg\", height=8, width=15, unit=\"in\", dpi = 120)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Create the ggplot map plot\nplot_2010 <- ggplot(filtered_forests$`2010`, aes(map_id = entity)) +\n  geom_map(\n    aes(fill = forest_converstion),\n    map = world,\n    color = \"#B2BEB5\",\n    linewidth = 0.25,\n    linetype = \"blank\"\n  ) +\n  geom_map(data = highlight_filtered_data$`2010`, aes(map_id = entity, fill = forest_converstion), map = highlight_world, color = \"#71797E\", show.legend = F) +\n  expand_limits(x = world$long, y = world$lat) +\n  scale_fill_manual(values = color_mapping, na.value = \"#F2F3F4\") +\n  coord_fixed(ratio = 1) +\n  labs(title = \"Net Forest Conversion by Country in 2010\",\n       subtitle = \"Net change in forest area measures forest expansion minus deforestation\",\n       caption = \"Data source: Our World in Data\",\n       fill = \"Net Forest Conversion (hectares)\"\n       ) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    plot.title      = element_text(size = 20, face = \"bold\", hjust = 0.5),\n    plot.subtitle   = element_text(size = 16, color = \"azure4\", hjust = 0.5),\n    plot.caption    = element_text(size = 12, color = \"azure4\", hjust = 0.95)\n  ) +\n  guides(\n    fill = guide_legend(\n      nrow = 1,\n      direction = \"horizontal\",\n      title.position = \"top\",\n      title.hjust = 0.5,\n      label.position = \"bottom\",\n      label.hjust = 1,\n      label.vjust = 1,\n      label.theme = element_text(lineheight = 0.25, size = 9),\n      keywidth = 1,\n      keyheight = 0.5,\n    )\n  )\n\nplot_2010\n```\n\n::: {.cell-output-display}\n![](sample_test_files/figure-html/unnamed-chunk-10-1.png){fig-align='center'}\n:::\n\n```{.r .cell-code}\nggsave(plot_2010, filename = \"q1/plot_2010.jpg\", height=8, width=15, unit=\"in\", dpi = 120)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Create the ggplot map plot\nplot_2015 <- ggplot(filtered_forests$`2015`, aes(map_id = entity)) +\n  geom_map(\n    aes(fill = forest_converstion),\n    map = world,\n    color = \"#B2BEB5\",\n    linewidth = 0.25,\n    linetype = \"blank\"\n  ) +\n  geom_map(data = highlight_filtered_data$`2015`, aes(map_id = entity, fill = forest_converstion), map = highlight_world, color = \"#71797E\", show.legend = F) +\n  expand_limits(x = world$long, y = world$lat) +\n  scale_fill_manual(values = color_mapping, na.value = \"#F2F3F4\") +\n  coord_fixed(ratio = 1) +\n  labs(title = \"Net Forest Conversion by Country in 2015\",\n       subtitle = \"Net change in forest area measures forest expansion minus deforestation\",\n       caption = \"Data source: Our World in Data\",\n       fill = \"Net Forest Conversion (hectares)\"\n       ) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    plot.title      = element_text(size = 20, face = \"bold\", hjust = 0.5),\n    plot.subtitle   = element_text(size = 16, color = \"azure4\", hjust = 0.5),\n    plot.caption    = element_text(size = 12, color = \"azure4\", hjust = 0.95)\n  ) +\n  guides(\n    fill = guide_legend(\n      nrow = 1,\n      direction = \"horizontal\",\n      title.position = \"top\",\n      title.hjust = 0.5,\n      label.position = \"bottom\",\n      label.hjust = 1,\n      label.vjust = 1,\n      label.theme = element_text(lineheight = 0.25, size = 9),\n      keywidth = 1,\n      keyheight = 0.5,\n    )\n  )\n\nplot_2015\n```\n\n::: {.cell-output-display}\n![](sample_test_files/figure-html/unnamed-chunk-11-1.png){fig-align='center'}\n:::\n\n```{.r .cell-code}\nggsave(plot_2015, filename = \"q1/plot_2015.jpg\", height=8, width=15, unit=\"in\", dpi = 120)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#make gif\nimgs <- list.files(path = \"q1/\", full.names = TRUE)\nimg_list <- lapply(imgs, image_read)\nimg_joined <- image_join(img_list)\nanim2 <- image_animate(image_scale(img_joined,\"2500x2500\"), fps = 1)\nimage_write(image = anim2,path = \"06042021_anim2.gif\")\nanim2\n```\n\n::: {.cell-output-display}\n![](sample_test_files/figure-html/unnamed-chunk-12-1.gif){fig-align='center'}\n:::\n:::\n",
    "supporting": [
      "sample_test_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}